# Isaac Gym PPOé…ç½®æ–‡ä»¶
# UR10e Task-Space RRT* + PPO è½¨è¿¹è·Ÿè¸ª - Isaac Gymç‰ˆæœ¬

# ç¯å¢ƒé…ç½®
env:
  num_envs: 1                    # å¹¶è¡Œç¯å¢ƒæ•°é‡
  max_steps: 100                 # å¢åŠ æœ€å¤§æ­¥æ•°ï¼Œç»™è¶³å¤Ÿæ—¶é—´å®Œæˆè½¨è¿¹
  device_id: 0                   # GPUè®¾å¤‡ID
  dt: 0.01                       # 100Hzï¼Œä¸MuJoCoåŸå§‹é…ç½®ä¸€è‡´

  # ğŸ¯ ç›®æ ‡ä½ç½®èŒƒå›´ (UR10eèˆ’é€‚å·¥ä½œåŒº)
  # ç¼©å°èŒƒå›´ç¡®ä¿ç›®æ ‡å¯è¾¾ï¼Œé¿å…è¿‡äºå›°éš¾çš„è¿œè·ç¦»ç›®æ ‡
  target_range:
    x: [-0.6, 0.6]               # Xè½´èŒƒå›´ (ç¼©å°åˆ°èˆ’é€‚å·¥ä½œåŒº)
    y: [-0.6, 0.6]               # Yè½´èŒƒå›´ (ç¼©å°åˆ°èˆ’é€‚å·¥ä½œåŒº)
    z: [0.0, 0.6]                # Zè½´èŒƒå›´ (é¿å…è¿‡é«˜æˆ–è¿‡ä½çš„ç›®æ ‡)

# ğŸ¯ è®¾å¤‡é…ç½®ï¼ˆå‚è€ƒisaac_gym_manipulatoræ–¹æ¡ˆï¼‰
device: "cuda:0"                 # PyTorchè®¾å¤‡ (ç”¨æˆ·æœåŠ¡å™¨ä½¿ç”¨GPU 2)
simulator:
  device_id: 0                  # Isaac Gymä»¿çœŸè®¾å¤‡ID (ç”¨æˆ·æœåŠ¡å™¨ä½¿ç”¨GPU 2)
  # ç‰©ç†å¼•æ“é…ç½®ï¼ˆåŸºäºisaac_gym_manipulatoræˆåŠŸé…ç½®ï¼‰
  solver_type: 1                 # ä½¿ç”¨solver_type=1
  num_position_iterations: 4     # ä½ç½®è¿­ä»£æ¬¡æ•°
  num_velocity_iterations: 1     # é€Ÿåº¦è¿­ä»£æ¬¡æ•°
  num_threads: 0                 # çº¿ç¨‹æ•°ï¼ˆ0=è‡ªåŠ¨ï¼‰
  use_gpu: true                  # å¯ç”¨GPU
  use_gpu_pipeline: false        # ç¦ç”¨GPUæ¸²æŸ“ç®¡çº¿

  # æ—¶é—´æ­¥é•¿é…ç½®
  substeps: 2                    # ä½¿ç”¨2ä¸ªå­æ­¥éª¤ï¼Œæé«˜ä»¿çœŸç¨³å®šæ€§

graphics:
  graphics_device_id: 0          # å›¾å½¢è®¾å¤‡ID (ç”¨æˆ·æœåŠ¡å™¨ä½¿ç”¨GPU 2)

visualization:
  enable: true                   # å¯ç”¨ä»¿çœŸå¯è§†åŒ–ï¼ˆå‚è€ƒisaac_gym_manipulatorï¼‰
  render_freq: 1                 # æ¸²æŸ“ï¿½ï¿½ç‡

# PPOç®—æ³•é…ç½®ï¼ˆä¼˜åŒ–è¶…å‚æ•°ï¼‰
ppo:
  # å­¦ä¹ ç‡ï¼ˆé™ä½ä»¥ç¨³å®šè®­ç»ƒï¼‰
  lr_actor: 5e-4                 # é™ä½Actorå­¦ä¹ ç‡ï¼Œæ›´ç¨³å®šå­¦ä¹ 
  lr_critic: 5e-4                # é™ä½Criticå­¦ä¹ ç‡

  # PPOæ ¸å¿ƒå‚æ•°ï¼ˆä¿å®ˆè®¾ç½®ï¼‰
  clip_eps: 0.15                 # é™ä½è£å‰ªå‚æ•°ï¼Œæ›´ä¿å®ˆæ›´æ–°
  gamma: 0.995                   # ç•¥å¾®æé«˜æŠ˜æ‰£å› å­ï¼Œæ›´é‡è§†é•¿æœŸå¥–åŠ±
  lam: 0.95                      # GAE Î»å‚æ•°ä¿æŒä¸å˜

  # æ­£åˆ™åŒ–ï¼ˆå¢åŠ æ¢ç´¢ï¼‰
  entropy_coef: 0.002             # å¢åŠ ç†µç³»æ•°ï¼Œé¼“åŠ±æ›´å¤šæ¢ç´¢
  value_coef: 0.5                # ä»·å€¼å‡½æ•°ç³»æ•°ä¿æŒä¸å˜

  # æ¢¯åº¦å¤„ç†
  max_grad_norm: 0.5             # æ¢¯åº¦è£å‰ªé˜ˆå€¼ä¿æŒä¸å˜

# è®­ï¿½ï¿½ï¿½é…ç½®ï¼ˆä¼˜åŒ–rolloutç­–ç•¥ï¼‰
train:
  rollout_length: 256           # é™ä½rollouté•¿åº¦ï¼Œæ›´é€‚åˆ500æ­¥episode
  batch_size: 64                 # æ‰¹æ¬¡å¤§å°
  num_updates: 10                # æ¯æ¬¡æ”¶é›†åæ›´æ–°æ¬¡æ•°
  num_episodes: 10000            # æ€»è®­ç»ƒå›åˆæ•°

  # ä¿å­˜å’Œæ—¥å¿—
  save_interval: 100             # ä¿å­˜é—´éš”
  log_interval: 10               # æ—¥å¿—é—´éš”

# ğŸ¯ æ–°çš„å¥–åŠ±å‡½æ•°é…ç½®ï¼ˆåŸºäºå…³èŠ‚è§’åº¦è¯¯å·®ï¼‰
reward:
  # ğŸ¯ å…³èŠ‚è§’åº¦è¯¯å·®å¥–åŠ±ï¼ˆä¸»è¦å¥–åŠ±ï¼‰
  accuracy:
    weight: 2.0                  # å…³èŠ‚è§’åº¦è¯¯å·®æƒé‡
    threshold: 0.05              # æœ«ç«¯ä½ç½®æˆåŠŸé˜ˆå€¼ï¼ˆæ¬¡è¦ï¼‰

  # ğŸƒ å…³èŠ‚è¿›åº¦å¥–åŠ±ï¼ˆå¥–åŠ±è¯¯å·®å‡å°‘ï¼‰
  progress:
    weight: 1.0                  # å…³èŠ‚è§’åº¦è¯¯å·®å‡å°‘æƒé‡

  # ğŸ“ æœ«ç«¯ä½ç½®è¯¯å·®å¥–åŠ±ï¼ˆæ¬¡è¦å¥–åŠ±ï¼‰
  position:
    weight: 0.5                  # æœ«ç«¯ä½ç½®è¯¯å·®æƒé‡

  # ğŸ”§ PIDå‚æ•°ç¨³å®šæ€§å¥–åŠ±
  stability:
    weight: 0.1                  # PIDå‚æ•°åˆç†æ€§çº¦æŸæƒé‡

  # ğŸŠ æˆåŠŸå¥–åŠ±
  extra:
    success_reward: 5.0          # å…³èŠ‚åˆ°è¾¾æˆåŠŸå¥–åŠ±
    position_success_reward: 2.0  # æœ«ç«¯ä½ç½®æˆåŠŸå¥–åŠ±
  
  

# ğŸš€ é€Ÿåº¦æ§åˆ¶é…ç½®
velocity_control:
  enabled: true
  # UR10eå…³èŠ‚é€Ÿåº¦é™åˆ¶ï¼ˆrad/sï¼‰ï¼š[120Â°, 120Â°, 180Â°, 180Â°, 180Â°, 180Â°]/s
  velocity_limits: [2.094, 2.094, 3.142, 3.142, 3.142, 3.142]
  integration_dt: 0.01  # ç§¯åˆ†æ—¶é—´æ­¥é•¿ï¼Œåº”åŒ¹é…env.dt

# UR10e PIDå‚æ•°é…ç½®ï¼ˆé’ˆå¯¹é€Ÿåº¦æ§åˆ¶ä¼˜åŒ–ï¼‰
pid_params:
  # PDå¢ç›Šå‚æ•°ï¼ˆé’ˆå¯¹é€Ÿåº¦æ§åˆ¶è°ƒä¼˜ï¼‰
  base_gains:
    # æ¯”ä¾‹å¢ç›Š P: [shoulder_pan, shoulder_lift, elbow, wrist_1, wrist_2, wrist_3]
    p: [1000.0, 1000.0, 800.0, 400.0, 200.0, 100.0]  # é€Ÿåº¦æ§åˆ¶çš„På¢ç›Š
    # å¾®åˆ†å¢ç›Š D: [shoulder_pan, shoulder_lift, elbow, wrist_1, wrist_2, wrist_3]
    d: [50.0, 50.0, 30.0, 20.0, 10.0, 5.0]           # é€Ÿåº¦æ§åˆ¶çš„Då¢ç›Š
    # ç§¯åˆ†å¢ç›Š I: [shoulder_pan, shoulder_lift, elbow, wrist_1, wrist_2, wrist_3]
    i: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]                   # é€Ÿåº¦æ§åˆ¶æš‚ä¸ä½¿ç”¨ç§¯åˆ†é¡¹

  # åŠ›çŸ©é™åˆ¶ï¼ˆUR10eå®˜æ–¹è§„æ ¼ï¼‰
  torque_limits: [330.0, 330.0, 150.0, 54.0, 54.0, 54.0]  # å®˜æ–¹é™åˆ¶å€¼

# ğŸ¯ å…³èŠ‚é™åˆ¶é…ç½®ï¼ˆç”¨äºç§¯åˆ†é’³ä½ï¼‰
joint_limits:
  # å…³èŠ‚è§’åº¦é™åˆ¶ï¼ˆradï¼‰ï¼šåŸºäºUR10eè§„æ ¼ [-360Â°, -360Â°, -180Â°, -360Â°, -360Â°, -360Â°] åˆ° [360Â°, 360Â°, 180Â°, 360Â°, 360Â°, 360Â°]
  lower_limits: [-6.283, -6.283, -3.142, -6.283, -6.283, -6.283]
  upper_limits: [6.283, 6.283, 3.142, 6.283, 6.283, 6.283]

# ğŸ¨ è½¨è¿¹å¯è§†åŒ–é…ç½®
trajectory_visualization:
  enable_trajectory_plotting: false    # å¯ç”¨è½¨è¿¹å¯è§†åŒ–
  plot_save_dir: "./trajectory_plots"  # å›¾ç‰‡ä¿å­˜ç›®å½•
  auto_show_plots: false               # è‡ªåŠ¨æ˜¾ç¤ºå›¾è¡¨
  save_interval_episodes: 10        # æ¯Nä¸ªepisodeä¿å­˜ä¸€æ¬¡å›¾è¡¨


# ä»·å€¼å½’ä¸€åŒ–é…ç½®
value_normalization:
  enabled: true                  # å¯ç”¨ä»·å€¼å½’ä¸€åŒ–
  beta: 0.995                    # EMAç³»æ•°
  epsilon: 1e-5                  # æ•°å€¼ç¨³å®šæ€§å‚æ•°
  clip_range: 10.0               # å½’ä¸€åŒ–è£å‰ªèŒƒå›´

# å¥–åŠ±å½’ä¸€åŒ–é…ç½®
reward_normalization:
  enabled: false                  # å¯ç”¨å¥–åŠ±å½’ä¸€åŒ–
  gamma: 0.99                    # æŠ˜æ‰£å› å­
  clip_range: 5.0                # å½’ä¸€åŒ–å€¼è£å‰ªèŒƒå›´
  warmup_steps: 100              # çƒ­èº«æ­¥æ•°
  normalize_method: 'running_stats'  # å½’ä¸€åŒ–æ–¹æ³•
  per_env: true                  # æ¯ä¸ªç¯å¢ƒç‹¬ç«‹å½’ä¸€åŒ–

# ğŸ›¤ï¸ Task-Space RRT* è½¨è¿¹è§„åˆ’é…ç½®
task_space:
  workspace_bounds:
    x: [-1.2, 1.2]               # Xè½´å·¥ä½œç©ºé—´èŒƒå›´ (æ‰©å¤§)
    y: [-1.2, 1.2]               # Yè½´å·¥ä½œç©ºé—´èŒƒå›´ (æ‰©å¤§)
    z: [-1.3, 1.0]                # Zè½´å·¥ä½œç©ºé—´èŒƒå›´ (è¿›ä¸€æ­¥æ‰©å¤§ä»¥åŒ…å«1.329)

ts_rrt_star:
  max_iterations: 2000           # RRT*æœ€å¤§è¿­ä»£æ¬¡æ•°
  step_size: 0.05                # æ­¥é•¿(ç±³)
  goal_bias: 0.1                 # ç›®æ ‡åå‘æ¦‚ç‡
  goal_tolerance: 0.15           # ç›®æ ‡å®¹å·®(ç±³)
  replanning_threshold: 0.1      # é‡è§„åˆ’é˜ˆå€¼(ç±³)
  max_waypoints: 100              # æœ€å¤§è·¯å¾„ç‚¹æ•°é‡

# ğŸ¯ è½¨è¿¹è·Ÿè¸ªå¥–åŠ±å‡½æ•°é…ç½®
trajectory_tracking:
  waypoint_threshold: 0.15       # è·¯å¾„ç‚¹åˆ°è¾¾é˜ˆå€¼(ç±³)
  waypoint_bonus: 5.0            # åˆ°è¾¾è·¯å¾„ç‚¹å¥–åŠ±
  smooth_coef: 0.1               # åŠ¨ä½œå¹³æ»‘æƒ©ç½šç³»æ•°
  use_deviation_penalty: false    # æ˜¯å¦ä½¿ç”¨è·¯å¾„åç¦»æƒ©ç½š
  deviation_coef: 2.0            # è·¯å¾„åç¦»æƒ©ç½šç³»æ•°
  distance_weight: 2.0           # è·ç¦»æƒ©ç½šæƒé‡
  progress_weight: 3.0           # è¿›æ­¥å¥–åŠ±æƒé‡
  log_tau: 0.0001                  # å¯¹æ•°å¥–åŠ±å‡½æ•°ä¸­çš„Ï„å€¼
  w1: 0.001                      # ä½ç½®è¯¯å·®æƒé‡
  lambda_ori: 0.7                # å§¿æ€è¯¯å·®æƒé‡

# ğŸ¯ åŠ¨ä½œé›†æˆï¼ˆAction Ensembles, AEï¼‰é…ç½®
ae:
  enabled: true                  # å¯ç”¨åŠ¨ä½œé›†æˆ
  alpha: 5.0                     # Weibullå½¢çŠ¶å‚æ•°å¢é•¿ç³»æ•°
  beta: 3.0                      # Weibullå°ºåº¦å‚æ•°å¢é•¿ç³»æ•°
  delta_std: 0.1                 # AEæ ‡å‡†å·®ï¼ˆè®ºæ–‡å»ºè®®å€¼ï¼‰
  lambda_max: 3


# ğŸ¯ ç­–ç•¥åé¦ˆï¼ˆPolicy Feedback, PFï¼‰é…ç½®
pf:
  enabled: false                  # å¯ç”¨ç­–ç•¥åé¦ˆ
  eta_min: 0.6                   # æœ€å°æŠ˜æ‰£å› å­
  eta_max: 0.99                  # æœ€å¤§æŠ˜æ‰£å› å­

# è°ƒè¯•å’Œç›‘æ§
debug:
  log_level: "INFO"              # æ—¥å¿—çº§åˆ«
  monitor_frequency: 10          # ç›‘æ§é¢‘ç‡
  save_visualization: false      # ä¿å­˜å¯è§†åŒ–æ•°æ®